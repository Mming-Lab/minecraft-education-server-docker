version: '3.8'

services:
  minecraft-edu:
    build: .
    container_name: minecraft-edu-server
    ports:
      - "${SERVER_PORT:-19132}:${SERVER_PORT:-19132}/udp"
      - "${SERVER_PORTV6:-19133}:${SERVER_PORTV6:-19133}/udp"
    environment:
      SERVER_PUBLIC_IP: ${SERVER_PUBLIC_IP:-localhost}
      SERVER_PORT: ${SERVER_PORT:-19132}
      SERVER_PORTV6: ${SERVER_PORTV6:-19133}
      GAMEMODE: ${GAMEMODE:-creative}
      DIFFICULTY: ${DIFFICULTY:-easy}
      MAX_PLAYERS: ${MAX_PLAYERS:-40}
      ALLOW_CHEATS: ${ALLOW_CHEATS:-false}
      ALLOW_LIST: ${ALLOW_LIST:-false}
      CHAT_RESTRICTION: ${CHAT_RESTRICTION:-None}
      VIEW_DISTANCE: ${VIEW_DISTANCE:-32}
      TICK_DISTANCE: ${TICK_DISTANCE:-4}
      PLAYER_IDLE_TIMEOUT: ${PLAYER_IDLE_TIMEOUT:-30}
      MAX_THREADS: ${MAX_THREADS:-8}
      LEVEL_NAME: ${LEVEL_NAME:-Bedrock level}
      LEVEL_SEED: ${LEVEL_SEED:-}
      DEFAULT_PLAYER_PERMISSION_LEVEL: ${DEFAULT_PLAYER_PERMISSION_LEVEL:-member}
      TEXTUREPACK_REQUIRED: ${TEXTUREPACK_REQUIRED:-true}
      CONTENT_LOG_FILE_ENABLED: ${CONTENT_LOG_FILE_ENABLED:-false}
    volumes:
      # ワールドデータ（永続化必須）
      - ./worlds:/minecraft/worlds

      # 認証セッション（永続化必須 - Device Code認証情報）
      - ./edu_server_session.json:/minecraft/edu_server_session.json

      # 設定ファイル（ホストで編集可能）
      - ./allowlist.json:/minecraft/allowlist.json
      - ./permissions.json:/minecraft/permissions.json
      - ./packetlimitconfig.json:/minecraft/packetlimitconfig.json
    restart: unless-stopped
    stdin_open: true
    tty: true
